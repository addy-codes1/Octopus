# ====================================================================================================
# AGENTIC RAG CHATBOT - ENVIRONMENT CONFIGURATION TEMPLATE
# ====================================================================================================
# This is a template file. Copy this to `.env` and fill in your actual values.
# NEVER commit the actual .env file to version control!
# ====================================================================================================

# ====================================================================================================
# APPLICATION SETTINGS
# ====================================================================================================
APP_NAME="Agentic RAG Chatbot"
APP_VERSION="1.0.0"
ENVIRONMENT="development"  # Options: development, staging, production
DEBUG=true
LOG_LEVEL="INFO"  # Options: DEBUG, INFO, WARNING, ERROR, CRITICAL

# API Server Configuration
API_HOST="0.0.0.0"
API_PORT=8000
API_WORKERS=4  # Number of uvicorn workers (production only)
API_RELOAD=true  # Hot reload for development

# ====================================================================================================
# SECURITY & AUTHENTICATION
# ====================================================================================================
# Generate a secure secret key: openssl rand -hex 32
SECRET_KEY="your-secret-key-here-generate-with-openssl-rand-hex-32"
JWT_ALGORITHM="HS256"
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# Password hashing
BCRYPT_ROUNDS=12

# CORS Configuration (comma-separated origins)
ALLOWED_ORIGINS="http://localhost:3000,http://localhost:5173"
ALLOWED_HOSTS="localhost,127.0.0.1,yourdomain.com"

# ====================================================================================================
# LLM CONFIGURATION (OpenAI)
# ====================================================================================================
# Get your API key from: https://platform.openai.com/api-keys
OPENAI_API_KEY="sk-..."
OPENAI_ORGANIZATION_ID=""  # Optional
OPENAI_MODEL="gpt-4o-mini"  # Options: gpt-4o, gpt-4o-mini, gpt-4-turbo, gpt-3.5-turbo
OPENAI_TEMPERATURE=0.0
OPENAI_MAX_TOKENS=2000
OPENAI_TIMEOUT=60  # Seconds
OPENAI_MAX_RETRIES=3

# Alternative LLM Providers (Optional)
# ANTHROPIC_API_KEY=""
# ANTHROPIC_MODEL="claude-3-5-sonnet-20241022"
# AZURE_OPENAI_ENDPOINT=""
# AZURE_OPENAI_API_KEY=""
# COHERE_API_KEY=""

# ====================================================================================================
# EMBEDDINGS CONFIGURATION
# ====================================================================================================
EMBEDDING_PROVIDER="openai"  # Options: openai, huggingface, cohere
EMBEDDING_MODEL="text-embedding-3-small"  # or text-embedding-3-large for better quality
EMBEDDING_DIMENSIONS=1536
EMBEDDING_BATCH_SIZE=100

# Alternative Embedding Providers
# COHERE_EMBEDDING_MODEL="embed-multilingual-v3.0"
# HUGGINGFACE_EMBEDDING_MODEL="sentence-transformers/all-MiniLM-L6-v2"

# ====================================================================================================
# VECTOR STORE CONFIGURATION
# ====================================================================================================
VECTOR_STORE_TYPE="chroma"  # Options: chroma, pinecone, qdrant, weaviate

# Chroma (for development/testing)
CHROMA_PERSIST_DIRECTORY="./data/chroma"
CHROMA_COLLECTION_NAME="rag_documents"

# Pinecone (recommended for production)
PINECONE_API_KEY=""
PINECONE_ENVIRONMENT=""  # e.g., us-east-1-aws
PINECONE_INDEX_NAME="rag-documents"

# Qdrant (alternative production option)
QDRANT_URL="http://localhost:6333"
QDRANT_API_KEY=""
QDRANT_COLLECTION_NAME="rag_documents"

# Weaviate (alternative production option)
WEAVIATE_URL="http://localhost:8080"
WEAVIATE_API_KEY=""
WEAVIATE_CLASS_NAME="Document"

# Vector Search Settings
VECTOR_SEARCH_K=5  # Number of documents to retrieve
VECTOR_SEARCH_SCORE_THRESHOLD=0.7  # Minimum similarity score
VECTOR_SEARCH_FILTER_ENABLED=true

# ====================================================================================================
# DATABASE CONFIGURATION (PostgreSQL)
# ====================================================================================================
# Format: postgresql+asyncpg://user:password@host:port/database
DATABASE_URL="postgresql+asyncpg://postgres:postgres@localhost:5432/rag_db"

# Connection Pool Settings
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=10
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600  # Recycle connections after 1 hour
DB_ECHO=false  # Set to true to log all SQL queries (development only)

# ====================================================================================================
# REDIS CONFIGURATION (Caching & Sessions)
# ====================================================================================================
REDIS_URL="redis://localhost:6379/0"
REDIS_PASSWORD=""  # Leave empty if no password
REDIS_TTL_SECONDS=3600  # Default cache TTL (1 hour)
REDIS_MAX_CONNECTIONS=50

# Session Configuration
SESSION_TTL_HOURS=24  # Session expiration time
ACTIVE_SESSION_TTL_MINUTES=60  # Active session timeout

# ====================================================================================================
# DOCUMENT PROCESSING CONFIGURATION
# ====================================================================================================
# File Upload Settings
MAX_FILE_SIZE_MB=25  # Maximum file size in megabytes
ALLOWED_FILE_EXTENSIONS="pdf,docx,doc,xlsx,xls,txt,md,csv,html,json"
UPLOAD_DIRECTORY="./data/uploads"

# Text Chunking Settings
CHUNK_SIZE=1000  # Characters per chunk
CHUNK_OVERLAP=200  # Overlap between chunks
CHUNKING_STRATEGY="semantic"  # Options: semantic, fixed, sentence

# Document Processing
ENABLE_OCR=true  # Enable OCR for images and scanned PDFs
OCR_LANGUAGE="eng"  # Tesseract language code
ENABLE_TABLE_EXTRACTION=true  # Extract tables from PDFs/Excel
PDF_PARSER="pypdf"  # Options: pypdf, pdfplumber, pymupdf

# Background Job Processing
CELERY_BROKER_URL="redis://localhost:6379/1"
CELERY_RESULT_BACKEND="redis://localhost:6379/1"
CELERY_TASK_TIME_LIMIT=600  # 10 minutes max per task
CELERY_WORKER_CONCURRENCY=4

# ====================================================================================================
# BLOB STORAGE CONFIGURATION (for uploaded files)
# ====================================================================================================
BLOB_STORAGE_TYPE="local"  # Options: local, s3, gcs, azure

# Local Storage (development)
LOCAL_STORAGE_PATH="./data/storage"

# AWS S3 (production)
AWS_ACCESS_KEY_ID=""
AWS_SECRET_ACCESS_KEY=""
AWS_S3_BUCKET=""
AWS_S3_REGION="us-east-1"
AWS_S3_ENDPOINT_URL=""  # Optional, for S3-compatible services

# Google Cloud Storage
GCS_PROJECT_ID=""
GCS_BUCKET=""
GCS_CREDENTIALS_PATH=""  # Path to service account JSON

# Azure Blob Storage
AZURE_STORAGE_CONNECTION_STRING=""
AZURE_STORAGE_CONTAINER=""

# ====================================================================================================
# CONVERSATION SETTINGS
# ====================================================================================================
MAX_CONVERSATION_HISTORY=20  # Maximum messages to keep in context
MAX_CONVERSATION_TOKEN_LENGTH=8000  # Maximum tokens in conversation history
QUERY_REFINEMENT_MAX_ATTEMPTS=2  # Max retry attempts for query refinement
ENABLE_QUERY_REFINEMENT=true
ENABLE_STREAMING=true  # Enable streaming responses
ENABLE_CITATIONS=true  # Include source citations in responses

# Default System Prompts
SYSTEM_PROMPT_REPHRASE="You are a helpful assistant that rephrases user questions to be standalone questions optimized for retrieval."
SYSTEM_PROMPT_CLASSIFY="You are a classifier that determines whether a user's question is within scope."
SYSTEM_PROMPT_RESPONSE="Answer the question based on the provided context and chat history. Be concise and accurate."

# ====================================================================================================
# RATE LIMITING
# ====================================================================================================
ENABLE_RATE_LIMITING=true
RATE_LIMIT_PER_MINUTE=20  # Per user
RATE_LIMIT_PER_HOUR=100  # Per user
RATE_LIMIT_PER_DAY=1000  # Per user
RATE_LIMIT_STORAGE="redis"  # Options: memory, redis

# API Key Rate Limits (if using API key auth)
API_KEY_RATE_LIMIT_PER_MINUTE=100

# ====================================================================================================
# MONITORING & OBSERVABILITY
# ====================================================================================================
# Sentry (Error Tracking)
SENTRY_DSN=""
SENTRY_ENVIRONMENT="development"
SENTRY_TRACES_SAMPLE_RATE=0.1  # 10% of transactions
SENTRY_PROFILES_SAMPLE_RATE=0.1

# Prometheus (Metrics)
ENABLE_METRICS=true
METRICS_PORT=9090

# OpenTelemetry (Distributed Tracing)
ENABLE_TRACING=false
OTEL_EXPORTER_OTLP_ENDPOINT=""
OTEL_SERVICE_NAME="rag-api"

# Logging
LOG_FORMAT="json"  # Options: json, text
LOG_FILE_ENABLED=false
LOG_FILE_PATH="./logs/app.log"
LOG_FILE_MAX_BYTES=10485760  # 10MB
LOG_FILE_BACKUP_COUNT=5

# ====================================================================================================
# FEATURE FLAGS
# ====================================================================================================
ENABLE_DOCUMENT_UPLOAD=true
ENABLE_DOCUMENT_DELETE=true
ENABLE_DOCUMENT_UPDATE=true
ENABLE_CONVERSATION_EXPORT=true
ENABLE_VOICE_INPUT=false
ENABLE_MULTI_LANGUAGE=false
ENABLE_ANALYTICS_DASHBOARD=true
ENABLE_ADMIN_PANEL=true

# Experimental Features
ENABLE_MULTI_MODAL=false  # Images, audio in chat
ENABLE_AGENT_MODE=false  # Advanced agentic workflows
ENABLE_CUSTOM_PERSONAS=true
ENABLE_DOCUMENT_COMPARISON=false

# ====================================================================================================
# EMAIL CONFIGURATION (for notifications, password reset)
# ====================================================================================================
ENABLE_EMAIL=false
SMTP_HOST="smtp.gmail.com"
SMTP_PORT=587
SMTP_USERNAME=""
SMTP_PASSWORD=""
SMTP_FROM_EMAIL="noreply@yourdomain.com"
SMTP_FROM_NAME="Agentic RAG Chatbot"
SMTP_USE_TLS=true

# ====================================================================================================
# WEBHOOKS & INTEGRATIONS
# ====================================================================================================
ENABLE_WEBHOOKS=false
WEBHOOK_SECRET=""  # For validating webhook payloads

# Slack Integration
SLACK_WEBHOOK_URL=""
SLACK_BOT_TOKEN=""

# Discord Integration
DISCORD_WEBHOOK_URL=""
DISCORD_BOT_TOKEN=""

# ====================================================================================================
# TESTING CONFIGURATION
# ====================================================================================================
TEST_DATABASE_URL="postgresql+asyncpg://postgres:postgres@localhost:5432/rag_test_db"
TEST_REDIS_URL="redis://localhost:6379/15"
PYTEST_PLUGINS="pytest-asyncio,pytest-cov"

# ====================================================================================================
# DEVELOPMENT TOOLS
# ====================================================================================================
# API Documentation
ENABLE_DOCS=true  # Swagger UI at /docs
ENABLE_REDOC=true  # ReDoc at /redoc
DOCS_URL="/docs"
REDOC_URL="/redoc"

# Debugging
ENABLE_DEBUG_TOOLBAR=false
ENABLE_SQL_ECHO=false  # Log all SQL queries

# ====================================================================================================
# FRONTEND CONFIGURATION
# ====================================================================================================
# These variables are used by the React frontend
REACT_APP_API_URL="http://localhost:8000"
REACT_APP_WS_URL="ws://localhost:8000"
REACT_APP_ENVIRONMENT="development"
REACT_APP_ENABLE_ANALYTICS=false
REACT_APP_SENTRY_DSN=""

# ====================================================================================================
# PRODUCTION-SPECIFIC SETTINGS
# ====================================================================================================
# Only used when ENVIRONMENT=production

# SSL/TLS
ENABLE_SSL=false
SSL_CERT_PATH=""
SSL_KEY_PATH=""

# Performance
ENABLE_GZIP=true
ENABLE_CACHING=true
CACHE_MAX_AGE=3600

# Security
ENABLE_CSRF_PROTECTION=true
ENABLE_RATE_LIMIT_HEADERS=true
ENABLE_SECURITY_HEADERS=true

# Backup & Recovery
ENABLE_AUTO_BACKUP=false
BACKUP_SCHEDULE="0 2 * * *"  # Daily at 2 AM
BACKUP_RETENTION_DAYS=30
BACKUP_STORAGE_PATH="./backups"

# ====================================================================================================
# COST OPTIMIZATION
# ====================================================================================================
# Token Usage Limits
MAX_TOKENS_PER_USER_PER_DAY=100000
MAX_TOKENS_PER_REQUEST=4000
ENABLE_TOKEN_TRACKING=true

# Caching Strategy
ENABLE_EMBEDDING_CACHE=true
ENABLE_LLM_RESPONSE_CACHE=true
LLM_CACHE_TTL_SECONDS=86400  # 24 hours

# Document Processing Limits
MAX_DOCUMENTS_PER_USER=100
MAX_TOTAL_DOCUMENT_SIZE_MB=500  # Per user

# ====================================================================================================
# NOTES
# ====================================================================================================
# 1. Generate SECRET_KEY: openssl rand -hex 32
# 2. For production, use environment-specific secrets management (AWS Secrets Manager, Vault, etc.)
# 3. Never commit the actual .env file to version control
# 4. Update ALLOWED_ORIGINS to match your frontend domain in production
# 5. Set ENVIRONMENT=production and DEBUG=false in production
# 6. Use strong, unique passwords for all services
# 7. Enable SSL/TLS in production
# 8. Configure proper monitoring and alerting
# 9. Set up regular backups
# 10. Review and adjust rate limits based on your usage patterns
# ====================================================================================================
